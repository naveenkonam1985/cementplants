{% extends 'base.html'%}
{%block content%}
<div class="row">
  <div class="col-9">
      
      <div id="map" style="height:550px; width: 100%;">
          <script>
               
                var osmUrl = 'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
          osmAttrib = '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
          osm = L.tileLayer(osmUrl, {maxZoom: 18, attribution: osmAttrib});

                var map = L.map('map').setView([17.344619, 78.574192], 5).addLayer(osm); 
          </script>
      </div>

  </div>
  <div class="col-3">
      <h4>Welcome to Cement Plants Location Project</h4>
      <div class="time">  
        <p>Date and time is : 
          <script>
              var time = new Date();
              document.write(time);
          </script>
      </p>
      </div>
    
      <div class="form">
          <form id = "sub_form" name = "queryform" action="" method="post" onsubmit="PlantQuery();return false">
            <div class="group-selection">  
                <label for="group"><strong>Group</strong></label>
                <select class="form-select" id = "group_selection" aria-label="Default select example" name = "group" id = "group" multiple>
                    {%for group in group%}
                        <option value="{{group}}">{{group}}</option>
                    {%endfor%}
                </select>
                <br>
                <div class="state_selection">
                    <label for="state"><strong>State</strong></label>
                    <select class="form-select" id = "state_selection" aria-label="Default select example" name = "state" multiple>
                        {%for state in state%}
                            <option value="{{state}}">{{state}}</option>
                        {%endfor%}
                    </select>
                    <br> 
                </div>
            </div>
              <div class="type">
                <label for=""><strong>Type</strong></label><br>
                <label for="iu">Integrated Unit</label>
                <input type="checkbox" name = 'iu' id = 'integrated' value = "IU">

                <label for="gu">Grinding Unit</label>
                <input type="checkbox" name = 'gu' id = 'grinding' value = "GU">

                <label for="cu">Clinkerisation Unit</label>
                <input type="checkbox" name = 'cu' id = 'clinker' value = "CU">
            </div>
            <br>
            <input type="submit" value="Submit">
            &nbsp;&nbsp;&nbsp;&nbsp;
            <input type="reset" value="Reset">
        </form>
       <p>Counter is: <span id = "counter"></span></p>
        
        <script src = "./static/cementplants.geojson" type="text/javascript"></script>
        <script type="text/javascript">

            var maroonMarker = {
                radius: 3.5,
                color: "#800000",
                fillColor: "#800000",
                weight: 4,
                opacity: 0.9,
                fillOpacity: 0.9
                };
            var blueMarker = {
                radius: 3.5,
                color: "#4250f4",
                fillColor: "#4250f4",
                weight: 4,
                opacity: 0.9,
                fillOpacity: 0.9
                };
            var greenMarker = {
                radius: 3.5,
                color: "#003300",
                fillColor: "#003300",
                weight: 4,
                opacity: 0.9,
                fillOpacity: 0.9
            };

            //function for popup
            function onEachFeature(feature, layer) {
                // does this feature have a property named popupContent?
                var popUpContent = '<table>';
                    for (var p in feature.properties) {
                        popUpContent += '<tr><td>' + p + '</td><td>'+ feature.properties[p] + '</td></tr>';
                        }
                    popUpContent += '</table>';
                    layer.bindPopup(popUpContent);
            }

            // function for form query
                
            function PlantQuery() { 
                
                var i_unit = document.getElementById('integrated'); 
                var g_unit = document.getElementById('grinding');
                var c_unit = document.getElementById('clinker');
                var integ_unit = i_unit.value;
                var grind_unit = g_unit.value;
                var clinker_unit = c_unit.value;
                        
                var s_sel = document.getElementById('state_selection');
                var state_sld = s_sel.options[s_sel.selectedIndex].value;
                    
                var g_sel = document.getElementById('group_selection');
                var group_sld = g_sel.options[g_sel.selectedIndex].value;

                var integ_layer = L.geoJSON(cementplants,{filter: function(feature, layer) {
                    return (feature.properties.Unit == integ_unit  && feature.properties.State == state_sld && feature.properties.Group == group_sld);
                    },pointToLayer: function (feature, latlng) {return new L.CircleMarker(latlng,maroonMarker)},
                    onEachFeature:onEachFeature});   
                
                var grind_layer = L.geoJSON(cementplants,{filter: function(feature, layer) {
                    return (feature.properties.Unit == grind_unit && feature.properties.State == state_sld && feature.properties.Group == group_sld);
                    },pointToLayer: function (feature, latlng) {return new L.CircleMarker(latlng,blueMarker)},
                    onEachFeature:onEachFeature});
                
                var clinker_layer = L.geoJSON(cementplants,{filter: function(feature, layer) {
                    return (feature.properties.Unit == clinker_unit && feature.properties.State == state_sld && feature.properties.Group == group_sld);
                    },pointToLayer: function (feature, latlng) {return new L.CircleMarker(latlng,greenMarker)},
                    onEachFeature:onEachFeature});  

                if (i_unit.checked == true){
                    integ_layer.addTo(map);
                }
                
                if (g_unit.checked == true){
                    grind_layer.addTo(map); 
                }
                        
                if (c_unit.checked == true){
                   clinker_layer.addTo(map);
                }
                
            }      
                      
        </script>  
      </div>
  </div>
</div>
{%endblock%}